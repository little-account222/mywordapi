async function getSourceCode() {
    const workId = document.getElementById('workId').value;
    const resultDiv = document.getElementById('result');
    const getButton = document.getElementById('btn');

    // 设置按钮为不可点击状态
    getButton.setAttribute('aria-disabled', 'true');

    if (!workId) {
        showToast('请输入作品ID', '#ff4d4d');
        // 恢复按钮可点击状态
        getButton.removeAttribute('aria-disabled');
        return;
    }

    try {
        const response = await fetch('https://dianmao.fantasywork.us.kg/kitten/get_work', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ workid: workId }),
        });

        // 如果响应不是JSON，则认为是文件
        if (response.headers.get('Content-Type') !== 'application/json') {
            // 处理文件下载
            const blob = await response.blob();
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'data.bcm4';
            document.body.appendChild(a);
            a.click();
            a.remove();
            window.URL.revokeObjectURL(url);

            resultDiv.textContent = '获取源码成功！';
            resultDiv.style.color = 'green';
            showToast('获取源码成功！', '#4caf50');
        } else {



                resultDiv.textContent = '获取源码失败。';
                resultDiv.style.color = 'red';
                showToast('获取源码失败。', '#ff4d4d');

        }
    } catch (error) {
        console.error('Error:', error);
        showToast('获取源码时发生错误，请稍后再试。', '#ff4d4d');
    } finally {
        // 请求完成后恢复按钮可点击状态
        getButton.removeAttribute('aria-disabled');
    }
}
